<!DOCTYPE html>
<html>
<head>
    <title>Meeting Manager</title>

    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
      .then(reg => console.log("Service Worker registered", reg))
      .catch(err => console.log("Service Worker failed", err));
  }
</script>
<meta name="theme-color" content="#000000">
    
    <style>
        body.light-mode {
            background: #ffffff;
            color: #000000;
        }

        body.dark-mode {
            background: #1e1e1e;
            color: #f0f0f0;
        }

        body {
            font-family: sans-serif;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        th {
            background: #f0f0f0;
        }

        input, textarea {
            width: 100%;
            margin: 5px 0;
            padding: 5px;
        }

        .form-section {
            margin-top: 20px;
        }

        button {
            padding: 5px 10px;
        }

        .logout {
            float: right;
            font-size: 14px;
        }

        .theme-toggle {
            float: left;
            font-size: 14px;
            background: #555;
            color: #fff;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        a {
            color: inherit;
        }

        body.dark-mode th, 
        body.dark-mode td {
            background: #2a2a2a;
            color: #ffffff;
            border: 1px solid #555;
        }

        body.dark-mode table {
            border-color: #555;
        }

        body.light-mode th, 
        body.light-mode td {
            background: #ffffff;
            color: #000000;
            border: 1px solid #ccc;
        }

        body.light-mode th {
            background: #f0f0f0;
        }

        .page-footer {
            margin-top: 40px;
            text-align: center;
            font-size: 10px;
            opacity: 0.7;
            color: inherit;
        }

        .file-label {
            font-size: 12px;
            color: #666;
        }
    </style>
    <script>
        function toggleTheme() {
            const body = document.body;
            const current = body.classList.contains("dark-mode") ? "dark" : "light";
            const newTheme = current === "dark" ? "light" : "dark";
            body.classList.remove("light-mode", "dark-mode");
            body.classList.add(newTheme + "-mode");
            localStorage.setItem("theme", newTheme);
        }

        window.onload = function () {
            const savedTheme = localStorage.getItem("theme") || "light";
            document.body.classList.add(savedTheme + "-mode");
        }
    </script>

    <script>
  setTimeout(function(){
    window.location.reload();
  }, 300000); // 5 minutes
</script>

</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">üåì Toggle Theme</button>
    <a href="/logout" class="logout">Logout</a>

    <h1 style="clear: both;">Meeting Manager</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul>
                {% for category, message in messages %}
                    <li style="color: {{ 'green' if category == 'success' else 'red' }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
    <p><a href="/print">üñ®Ô∏è Print 3-Day Schedule</a></p>
    <p>
        <a href="/view">üìÇ View All Meetings</a>
        <a href="/download/excel"> (Download as Excel)</a>
        <a href="/download/pdf"> (Download PDF)</a>
    </p>

    <div class="form-section">
        <form method="post" action="/add" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="Meeting Title" required>
            <input type="date" name="date" required>
            <input type="time" name="time" required>
            <textarea name="brief" placeholder="Meeting Brief" rows="2"></textarea>
            <label class="file-label">Attach Brief File (PDF, Word, Excel, PPT):</label>
            <input type="file" name="brief_file" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">

            <textarea name="minutes" placeholder="Meeting Minutes" rows="3"></textarea>
            <label class="file-label">Attach Minutes File (PDF, Word, Excel, PPT):</label>
            <input type="file" name="minutes_file" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">

            <button type="submit">Add Meeting</button>
        </form>
    </div>

    <div style="margin-top: 20px; margin-bottom: 10px;">
        <a href="/?order={{ 'asc' if order == 'desc' else 'desc' }}" 
           style="padding: 6px 12px; background: #28A745; color: white; text-decoration: none; border-radius: 4px; margin-left: 10px;">
            üîÉ Sort: {{ 'Oldest First' if order == 'desc' else 'Newest First' }}
        </a>
    </div>

    
    <table>
        <tr>
            <th>Title</th>
            <th>Date</th>
            <th>Time</th>
            <th>Brief</th>
            <th>Minutes</th>
            <th>Action</th>
        </tr>
        {% for m in meetings %}
        <tr>
            <td>{{ m.title }}</td>
            <td>{{ m.date | datetimeformat }}</td>
            <td>{{ m.time }}</td>
            <td>
                {{ m.brief }}
                {% if m.brief_file %}
                    <br><a href="{{ m.brief_file.url }}" target="_blank" download>üìé Download Brief</a>
                {% endif %}
            </td>
            <td>
                {{ m.minutes }}
                {% if m.minutes_file %}
                    <br><a href="{{ m.minutes_file.url }}" target="_blank" download>üìé Download Minutes</a>
                {% endif %}
            </td>
            <td>
                <a href="/edit/{{ m.id }}">Edit</a> |
                <a href="/delete/{{ m.id }}" onclick="return confirm('Delete this meeting?')">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </table>
    
    <footer class="page-footer">
        <div style="margin-bottom: 5px;"> {{ hits }}</div>
        ¬© 2025 Meeting Manager | Tariq
    </footer>
</body>
</html>
